<!doctype html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Testing the PubMed Search Tester</title>
    <link href="./pmtest.css" rel="stylesheet">
    <!-- Bootstrap core CSS -->
    <link href="https://getbootstrap.com/docs/4.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <!-- Custom styles for this template -->
  </head>

  <body>

<main role="main">
  <!-- Main jumbotron for a primary marketing message or call to action -->
  <div id="topbanner" class="jumbotron">
    <div class="container">
      <h1 class="display-3">Testing the PubMed Search Tester</h1>
    </div>
  </div>

  <div class="container" id="explanation">
  <h1>Welcome!</h1>
<div class="row">
  <div class="col-md-7">
  <p>Thank you for agreeing to participate in my research project to test the efficacy of using small validation sets of
    items to evaluate PubMed search strategies.</p>

    <p>In a moment, you will be presented with a series of question prompts and some articles to sort for Searches. For each question,
      you will be given a rubric that will help you decide what a "Good" article for answering that question might be,
     then a list of PubMed citations to evaluate against that rubric.</p>
     <p>You will be evaluating each item using <em>only</em> what you can determine from the citation itself (just the title, abstract, etc.).
       For each citation, choose "Good" for items that meet the rubric, and "Bad" for those that don't. If you are unsure, or there's not enough
       information given in the citation, you can choose to "Skip" it. Once you have found 40 "Good" citations, you can
       move on to the next question if you like (for a total of three possible questions).</p>
      <p>The whole process should take around 10 minutes per question.</p>
    </div>
    <div class="col-md-4 ">
      <div class="card mb-3 demoinfo">

        <div class="card-body">
      <form class="form-group">
      <div class="form-group mb-2">
        <label for="email"><strong>Email address: </strong></label>
        <input type="text" class="form-control" id="email" size="40">
      </div>
      </form>

      <p>If you haven't already, please take just a moment to fill out the <a href="https://ugeorgia.ca1.qualtrics.com/jfe/form/SV_a98cyq7oTo6Hkbz">survey at this link</a>.
        Your email address will be paired with the survey data to see if different types of PubMed users obtain
        different results. Your information will <em>only</em> be used for this project, and all responses to both the survey and this instrument are <strong>strictly
          confidential</strong>. Have a look at the <a href="https://esperr.github.io/assets/Random_Screen_Consent_Letter.pdf">formal consent letter</a> if you haven't done so already.</p>
          </div></div>

  </div></div>








  <button id="showquestions" class="btn btn-primary mb-2" type="button">Begin</button>
</div>

  </div>


  <div class="container" id="mainsearch">
      <div class="row">
        <div class="col-md-10">
          <div class="card">
            <div class="card-body">
              <div class="card-title">
          <h4>Question:</h4>
        </div>
          <div id="rubric">
          </div>
          <div id="searchused"><strong>Note:</strong> these citations are randomly selected from those retrieved by the PubMed search
          "<em><span id="search" /></em>"
        </div>
        <button id="runsearch" class="btn btn-primary mb-2" type="button">Start sorting articles!</button>
        <!--Minimum number of "good" articles to select:
        <select id="minimumgood">
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="40">40</option>

        </select>-->
      </div>
      </div>
        </div>
      </div>
      <br /><br />

    </div>


    <div id="lists" class="container">
      <div id="teststeps">
      <button type="button" id="fetchmore" class="btn btn-primary">Get back to sorting</button>
      &nbsp;&nbsp;
     </div>
     <div class="alert alert-secondary alert-dismissible fade show" role="alert">
        Not sure if you picked correctly? Choose an item below to see details and change its sort status.
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
     </div>
      <div class="row">

        <div class="col-md-4">
          <h4>"Good" documents: <span id="goodnumber">0</h4>

          <div id="goodlist">
          </div>
        </div>
        <div class="col-md-4">
          <h4>"Bad" documents: <span id="badnumber">0</h4>

          <div id="badlist">
          </div>
        </div>
        <div class="col-md-4">
          <h4>Skipped documents: <span id="skipnumber">0</h4>

          <div id="skippedlist">
          </div>
        </div>
      </div>


    </div>

    <div id="judge-doc" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Curent status: <span id="currentstatus"></span></h4>
          </div>
          <div id="doc-display" class="modal-body">
          </div>
          <div class="modal-footer">
              <button type="button" id="markbad" class="btn btn btn-danger">← Bad</button>
              <button type="button" id="markmeh" class="btn btn-light">↑ Skip</button>
              <button type="button" id="markgood" class="btn btn-success">→ Good</button>
        </div>
        </div>
      </div>
    </div>

    <div id="thanks" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Thanks!</h4>
          </div>
          <div class="modal-body">
            <p>Thank you so much for taking the time to assist with this project! Your responses will be invaluable for
            helping determine the viability of this approach. If you would like to try using randomly-selected PubMed items to
            generate your <em>own</em> validation sets, take a look at <a href="https://esperr.github.io/pubmed-search-tester/">PubMed
            Search Tester</a>.
          </p>
          <p>If you have any comments or questions about this project, please don't hestiate to drop me a line at <a href="mailto:ed_sperr@hotmail.com">ed_sperr@hotmail.com</a>.
          </div>
        </div>
      </div>
    </div>

    <div id="continuing" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Do you wish to continue?</h4>
          </div>
          <div class="modal-body">
            <p>One question down! Do you want to screen items for the next question, or are you done for now?</p>
            <button id="nextquestion" class="btn btn-primary" type="button">Let's screen some more!</button>
            <button id="getout" class="btn btn-outline-danger" type="button">Maybe another time</button>
          </div>
        </div>
      </div>
    </div>

    <div id="emailnag" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Want to submit your email?</h4>
          </div>
          <div class="modal-body">
            <p>Before you get started, would you like to submit your email address? This, combined with your answers to the <a href="https://ugeorgia.ca1.qualtrics.com/jfe/form/SV_a98cyq7oTo6Hkbz">short demographic survey</a>, will help
              discern if different types of searchers have different results using this method. It will also help to aggregate your results should you want to
              come back later and participate again.</p>
              <p>If you don't want to share your email, no worries! You are welcome to participate anonymously.</p>
              <form class="form-inline">
              <div class="form-group mb-2">
                <input type="text" class="form-control" id="emailtwo" size="40">
              </div>
              <button id="emailtrytwo" class="btn btn-primary mb-2" type="button">Share my email</button>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Particpate anonymously</button>
          </div>
        </div>
      </div>
    </div>

  </main>

  <footer class="container">
    <hr>
    <span class="text-muted">Design and contruction by <a href="https://esperr.github.io/about/">Ed Sperr, M.L.I.S.</a>  |
      Data from <a href="http://www.ncbi.nlm.nih.gov/">NCBI</a>
     | See the code at <a href="https://github.com/esperr/pubmed-search-tester">GitHub</a></span></footer>
  </body>
  <script>

  (function() {

  var startDocs = {};
  var today = new Date();
  var starttime;
  var endtime;
  var startWebEnv;
  var startCount;
  //var goodWebEnv;
  //var badWebEnv;
  //var skipWebEnv;
  var searches = {};
  var searchcount;
  var sieveDocs = [];
  var skipDocs = [];
  var goodDocs = [];
  var badDocs = [];
  //var currenttest = 0;
  //can reset this to whatever is needed -- see if 40 is sustainable
  var mingood = 40;
  var alltests = { user: {}, tests: {} };

  if (location.search) {
    var queryDict = {};
    location.search.substr(1).split("&").forEach(function(item) {
        queryDict[item.split("=")[0]] = item.split("=")[1]
    })
    if (queryDict["email"]) {
      $("#email").val(queryDict["email"]);
    }
  }

  var testsearches = [
    {search: '"Diabetes Mellitus, Type 2/drug therapy"[mesh] AND review AND 2010/1/1[PDAT] : 2030/1/1[PDAT]',
    rubric: "<p>Find recent <strong>reviews</strong> (either narrative or systematic) of <strong>drugs</strong> used for the <strong>treatment</strong> of   \
    <strong>Type 2 Diabetes</strong>.</p> \
    <p><strong>Select</strong> those articles which are plainly reviews of one or more medications used to treat Type II Diabetes mellitus.  \
    </p><p><strong>Reject</strong> opinion pieces or descriptions of single studies. Also, reject those articles which are <em>primarily</em> about other \
    non-treatment aspects of diabetes or about other disorders entirely.</p>"},
    {search: '(((((("Wuhan"[All Fields] AND (virus OR viral OR pneumonia OR outbreak OR epidemic)) OR \
    ("coronavirus"[MeSH Terms] OR nCoV[all fields] OR “corona virus”[All Fields] OR "coronavirus"[All Fields])) AND \
     (2019/12[PDAT] OR 2020[PDAT])))) OR (("COVID-19"[All Fields] OR "COVID19"[All Fields] OR "COVID-2019"[All Fields] OR \
     "severe acute respiratory syndrome coronavirus 2"[Supplementary Concept] OR "severe acute respiratory syndrome \
     coronavirus 2"[All Fields] OR "2019-nCoV"[All Fields] OR "SARS-CoV-2"[All Fields] OR "2019nCoV"[All Fields] OR \
     "2019 ncov”[All Fields]))) AND diagnosis',
    rubric:"<p>Find items on the <strong>diagnosis</strong> of <strong>COVID-19</strong>.</p> \
    <p><strong>Select</strong> those articles that describe diagnostic tests or techniques. \
    </p><p><strong>Reject</strong> items that are <em>primarily</em> about treatment, epidemiology, etc. or which focus on coronavirus diseases other than COVID-19.</p>"},
    {search: "trial AND coronary artery disease AND statin",
    rubric: "<p>Find <strong>clinical trials</strong> about the use of <strong>statins</strong> to treat <strong>coronary artery disease</strong>.</p> \
    <p><strong>Select</strong> those articles that appear to describe a discrete clinical trial on the safety or efficacy of statins in this context. \
    </p><p><strong>Reject</strong> opinion pieces or reviews of multiple trials. Also reject any items concerning statins in contexts or disorders \
    other than coronary artery disease.</p>"}
  ];

  var currenttest = getRandomIntInclusive(0, testsearches.length-1);
  $("#mainsearch").hide();
  $("#lists").hide();


//  $(document).keydown(function(e) {
//    if(e.keyCode == 13) {
//      //Because both IE and FF now "helpfully" ignore the spec and treat 'button' the same as 'submit'
//      e.preventDefault();
//      if($('#mainsearch').is(':visible')){
//        $( "#runsearch" ).trigger( "click" );
//      }
//      if($('#nextsearch').is(':visible')){
//        $( "#testversion" ).trigger( "click" );
//      }
//    }
//  });

  $("#judge-doc").keydown(function(e) {
    if(e.key == "ArrowLeft") {
      $( "#markbad" ).trigger( "click" );
    }
    if(e.key == "ArrowUp") {
      $( "#markmeh" ).trigger( "click" );
    }
    if(e.key == "ArrowRight") {
      $( "#markgood" ).trigger( "click" );
    }
  });

  $("#showquestions").click(function(){
     checkemail();
     populatesearch(currenttest);
     $("#explanation").hide();
   });

  $("#runsearch").click(function(){
     $("#mainsearch").hide();
     $("#explanation").hide();
     $("#lists").show();
     var searchstr = testsearches[currenttest].search
     startSearch(searchstr);
   });

   $("#fetchmore").click(function(){
     getDoc(20);
     fetchunsorted();
    });

    $( "#lists" ).on( "click", ".card", function() {
      var selecteddoc = $(this).attr("id");
      showDoc(selecteddoc);
    });

   $( ".row" ).on( "click", "#reset", function() {
       location.replace(location.pathname);
    });

   $("#starttest").click(function(){
      $("#lists").hide();
      $("#variantperformance").hide();
      $("#results").show();
      var searchstr = $("#search").val();
      var totalsorted = goodDocs.length + badDocs.length + skipDocs.length;
      searches["start"] = { "search": searchstr, "screened": totalsorted, "good": goodDocs.length, "bad": badDocs.length };
      writeResults(searchstr, startCount, totalsorted, goodDocs.length, badDocs.length);
      searchcount = 0;
    });

   $("#judge-doc button").click(function(){
     if (goodDocs.length >= mingood) {
       $("#judge-doc").modal('hide');
       doneTesting();
     } else {
       var selecteddoc = $( "#judge-doc .doctitle" ).attr("data-pmid");
       if ($(this).attr("id") == "markgood") { startDocs[selecteddoc].sortstatus = "Good" }
       if ($(this).attr("id") == "markmeh") { startDocs[selecteddoc].sortstatus = "Skipped" }
       if ($(this).attr("id") == "markbad") { startDocs[selecteddoc].sortstatus = "Bad" }
       if (sieveDocs.length < 3) {
         getDoc(10);
       }
       updateLists();
       fetchunsorted();
     }
    });

   function populatesearch(currenttest) {
     var mytest = testsearches[currenttest];
     $("#lists").hide();
     $( "#goodlist" ).empty();
     $( "#badlist" ).empty();
     $( "#skippedlist" ).empty();
     $("#goodnumber").text("0");
     $("#badnumber").text("0");
     $("#skipnumber").text("0");
     $("#results").hide();
     $("#mainsearch").show();
     $( "#rubric" ).empty();
     $( "#search" ).empty();
     $( "#rubric" ).append( mytest.rubric );
     $( "#search" ).append( mytest.search );
   }

   function startSearch(term) {
     starttime = performance.now();
     esearch(term)
     .then(function( data ) {
       startWebEnv = data.esearchresult.webenv;
       startCount = data.esearchresult.count;
       getDoc(40);
       fetchunsorted();
     });
   }

   function esearch(term) {
      pausetime = performance.now();
      return $.ajax({
        url: 'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi',
        data: {
          db: 'pubmed',
          usehistory: 'y',
          term: term,
          retmode: 'json',
          retmax: 0,
          email: 'ed_sperr@hotmail.com',
          tool: 'searchtest',
          api_key: 'f069cf776feaa627ab9b1e0fc2b090610708'
        }
        });
   }

   function efetch(index) {
      pausetime = performance.now();
      return $.ajax({
        url: 'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi',
        data: {
          db: 'pubmed',
          retstart: index,
          retmax: 1,
          query_key: 1,
          WebEnv: startWebEnv,
          retmode: 'xml',
          rettype: 'abstract',
          email: 'ed_sperr@hotmail.com',
          tool: 'searchtest',
          api_key: 'f069cf776feaa627ab9b1e0fc2b090610708'
        }
      });
   }

   function getDoc(numrequired) {
     var indexes = [];
     var currentmeh = Number($("#mehnumber").text());
     $("#mehnumber").text(currentmeh + numrequired);
     for (i = 0; i < numrequired; i++) {
       var index = getRandomIntInclusive(1, startCount);
       indexes.push(index);
     }
     var uniqueindexes = indexes.filter( onlyUnique );
     for (i = 0; i < numrequired; i++)  {
       checktime();
       function checktime() {
         var t1 = performance.now();
         var timediff = t1 - pausetime;
         if (timediff > 500) {
           callutils();
         } else {
           setTimeout(checktime, 50);
         }
       }
       function callutils() {
         var myDoc = {};
         var index = indexes.pop();
         efetch(index)
         .done(function( xml ) {
           var authors = [];
           $(xml).find('PubmedArticle').each(function(){
             myDoc.pmid = $(this).find("PMID:first").text();
             if (startDocs[myDoc.pmid]) {
               console.log("We already have this one...")
             } else {
               myDoc.title = $(this).find("ArticleTitle").text();
               myDoc.abstract = $(this).find("AbstractText").text();
               var journal = $(this).find("Journal");
               myDoc.journalTitle = journal.find("Title").text();
               myDoc.journalAbbreviation = journal.find("ISOAbbreviation").text();
               var journalIssue = journal.find("JournalIssue");
               myDoc.volume = journalIssue.find("Volume").text();
               myDoc.issue = journalIssue.find("Issue").text();
               var journalDate = journalIssue.find("PubDate");
               myDoc.year = journalDate.find("Year").text();
               myDoc.month = journalDate.find("Month").text();
               myDoc.day = journalDate.find("Day").text();
               myDoc.medlinedate = journalDate.find("MedlineDate").text();
               myDoc.pages = $(this).find("MedlinePgn").text();
               $(this).find('Author').each(function(){
                 var lastname = $(this).find("LastName").text();
                 var intials = $(this).find("Initials").text();
                 authors.push(lastname + " " + intials)
               });
               myDoc.authors = authors;
               myDoc.sortstatus = "Unsorted";
               startDocs[myDoc.pmid] = myDoc;
               sieveDocs.push(myDoc.pmid);
           }
         });
        });
       }
     }
   }

   function showDoc(pmid) {
     $("#doc-display").empty();
     var myDoc = startDocs[pmid];
     $("#judge-doc").modal();
     $("#currentstatus").text(myDoc.sortstatus);
     if (myDoc.sortstatus == "Unsorted") { $("#currentstatus").attr("style", "color:gray;") }
     if (myDoc.sortstatus == "Bad") { $("#currentstatus").attr("style", "color:red;") }
     if (myDoc.sortstatus == "Good") { $("#currentstatus").attr("style", "color:green;") }
     $("#doc-display").append('<div class="sievedoc"></div>');
     $(".sievedoc").append('<h4 class="card-title doctitle" data-pmid=' + pmid + '>' + myDoc.title + '</h4>');
     var citestring = '<em>' + myDoc.journalTitle + '</em>. ' + formatIssuestring(startDocs[pmid]);
     var myauthorstring = formatAuthorstring( myDoc.authors, 4);
     if (myauthorstring.trim().length != 0 ) {
       citestring = myauthorstring + '. ' + citestring;
     }
     $(".sievedoc").append('<div class="card-subtitle mb-2 text-muted">' + citestring + '</div>');
     $(".sievedoc").append('<p class="docabstract">' + myDoc.abstract + '</p>');
     $(".sievedoc").append('<p id="pubmedlink">PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/' + pmid + '" target="_pubmedlink">' + pmid + '</a></p>');
   }

   function fetchunsorted() {
     if (sieveDocs.length > 0) {
       showDoc(sieveDocs[getRandomIntInclusive(0, sieveDocs.length-1)]);
     } else {
       setTimeout(fetchunsorted, 50);
     }
   }

   function updateLists() {
     $("#sievelist").empty();
     sieveDocs.length = 0;
     $("#goodlist").empty();
     goodDocs.length = 0;
     $("#badlist").empty();
     badDocs.length = 0;
     $("#skippedlist").empty();
     skipDocs.length = 0;
     var pmids = Object.keys(startDocs)
     for (var i=0; i<pmids.length; i++) {
       polulateLists(pmids[i], startDocs[pmids[i]].sortstatus);
     }
     $("#mehnumber").text(sieveDocs.length);
     $("#goodnumber").text(goodDocs.length);
     $("#badnumber").text(badDocs.length);
     $("#skipnumber").text(skipDocs.length);
   }


   function polulateLists(pmid, status) {
     if (status == "Unsorted") {
       sieveDocs.push(pmid);
       listname = "sievelist";
     }
     if (status == "Good") {
       goodDocs.push(pmid);
       listname = "goodlist";
     }
     if (status == "Bad") {
       badDocs.push(pmid);
       listname = "badlist";
     }
     if (status == "Skipped") {
       skipDocs.push(pmid);
       listname = "skippedlist";
     }
     var mylist = "#" + listname;
     var myDoc = startDocs[pmid];
     $(mylist).append('<div class="card listarticle" id=' + pmid + ' >');
     $("#" + pmid).append('<div class="card-body">');
     $("#" + pmid + " .card-body").append('<div class="card-title">' + myDoc.title + '</div>');
     var citestring = '<em>' + myDoc.journalAbbreviation + '</em>. ' + formatIssuestring(myDoc);
     var myauthorstring = formatAuthorstring( myDoc.authors, 2);
     if (myauthorstring.trim().length != 0 ) {
       citestring = myauthorstring+ '. ' + citestring;
     }
     $("#" + pmid + " .card-body").append('<div class="card-subtitle mb-2 text-muted">' + citestring  + '</div>');
     //$(mylist + " .card .card-body").last().append('<a href="#" class="card-link">' + pmid + '</a>')
   }

   function doneTesting() {
     endtime = performance.now();
     var elapsedtime = endtime - starttime;
     //alert("done!");
     var searchstr = testsearches[currenttest].search;
     //postResults(searchstr, elapsedtime, goodDocs, badDocs, skipDocs);
     //currenttest = currenttest + 1;
     testsearches.splice(currenttest,1);
     console.log(testsearches);
     if (testsearches.length < 1) {
       $("#lists").hide();
       $("#thanks").modal();
     } else {
       //var startDocs = {};
       for (doc in startDocs) {
         startDocs[doc] = {};
         delete startDocs[doc];
       }
       sieveDocs.length = 0;
       goodDocs.length = 0;
       badDocs.length = 0;
       currenttest = getRandomIntInclusive(0, testsearches.length-1);
       console.log(currenttest);
       $("#lists").hide();
       $("#continuing").modal();
     }
   }

  function postResults(question, elapsedtime, goodpmids, badpmids, skippedpmids) {
    var email = $("#email").val();
    $.ajax({
        type: "POST",
        //url: "http://localhost:8080/writeresults",
        url: "https://api-project-770991577225.ue.r.appspot.com/writeresults",
        data: {
          email: email,
          question: question,
          testdate: today,
          elapsedtime: elapsedtime,
          goodpmids: JSON.stringify(goodpmids),
          badpmids: JSON.stringify(badpmids),
          skippedpmids: JSON.stringify(skippedpmids),
        },
        success: function() { console.log("Posted!")},
      });
  }

  function formatIssuestring(myDoc) {
    if (myDoc.year == "") { var issuestring = myDoc.medlinedate }
    else {
      var issuestring = myDoc.year + " " + myDoc.month + " " + myDoc.day;
    }
    issuestring = issuestring.trim() + "; "
    issuestring = issuestring + myDoc.volume;
    if (myDoc.issue !== "") { issuestring = issuestring + " (" + myDoc.issue + ") " }
    issuestring = issuestring.trim() + ": "
    issuestring = issuestring + myDoc.pages;
    return issuestring;
  }

  function formatAuthorstring(authors, authornumber) {
    if (authors[0] == "") {
      return;
    } else {
      if (authors.length > authornumber) {
        var myauthors = authors.splice(0,authornumber-1).join(', ') + ", et al";
      } else {
        var myauthors = authors.join(', ');
      }
      return myauthors;
    }
  }

  function checkemail() {
    if ( $("#email").val() == "") {
      $("#emailnag").modal();
    }
  }

  $("#emailtrytwo").click(function(){
    $("#email").val( $("#emailtwo").val() );
    $("#emailnag").modal('hide');
   });

  $("#nextquestion").click(function(){
    $("#continuing").modal('hide');
    populatesearch(currenttest);
  });

  $("#getout").click(function(){
    $("#continuing").modal('hide');
    $("#thanks").modal();
  });

  function getRandomIntInclusive(min, max) {
     min = Math.ceil(min);
     max = Math.floor(max);
     return Math.floor(Math.random() * (max - min + 1)) + min;
   }

  function onlyUnique(value, index, self) {
     return self.indexOf(value) === index;
  }

  function round(value, precision) {
    var multiplier = Math.pow(10, precision || 0);
    return Math.round(value * multiplier) / multiplier;
  }

 })
 ();

</script>

  </html>
